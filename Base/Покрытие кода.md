07.10.2024 00:41
Tags: #info

---
# Покрытие кода

Одна из важнейших метрик качества кода — **степень покрытия тестами** (**test coverage**). В Go для вычисления этой метрики используется флаг `-cover` утилиты `go test`, подробнее о котором можно почитать в [официальном блоге Go](https://blog.golang.org/cover).

Например, если вы хотите узнать степень покрытия тестами пакета `math` из стандартной библиотеки, надо вызвать команду `go test math -cover`:

```
ok      math    0.003s    coverage: 86.8% of statements 
```

Определим покрытие тестами функции `Add` из примера выше:

```
% go test -cover
PASS
coverage: 80.0% of statements
ok      tests_06        0.233s 
```

Но знания одной только метрики зачастую не хватает, и нужно выяснить, какие именно строки кода не были задействованы при прогоне тестов. Этот функционал тоже идёт «из коробки» в виде флага `-coverprofile` утилиты `go test` и специальной утилиты [go cover](https://golang.org/cmd/cover/) для анализа профиля покрытия тестами.

Итак, если вы хотите узнать, какой именно код пакета `math` не был покрыт тестами, надо сделать следующее:

1. Запустить на нём утилиту `go test` и сохранить файл профиля покрытия тестами. Путь к файлу с профилем — это значение флага `-coverprofile`. В данном случае сохраним его в файл `coverage.out` текущей директории:

```
go test . -coverprofile=coverage.out 
```

2. Проанализировать полученный файл утилитой `cover`. Например, по собранному профилю можно получить HTML-представление исходного кода с дополнительной разметкой, связанной с покрытием тестами:

```
go tool cover -html=coverage.out 
```

После выполнения автоматически запустится браузер, где будет отображена информация по покрытию.

![[Pasted image 20241007004413.png]]

---
### Zero-links:
[[00 Backend]] [[00 Golang]] [[00 Tests]]

---
### Links: